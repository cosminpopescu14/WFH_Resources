
name: CI

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:

  build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2

    - name: generating necessary folders
      run: |
          mkdir output
          
    - name: generate all
      run: |
        chmod +x ./makeData/compile.bat
        cd makeData        
        ./compile.bat
        rm ../obj/all.md
        cp ./all.md ../obj/all.md
        ls -l ../obj/all.md
        chmod 777 ../obj/all.md
        ls -l ../obj/all.md
        echo 'finish generate all'

    - name: generate html
      uses: docker://pandoc/latex:2.9
      with: ## needs a README in your repo root!          
        args: "-d makeData/headerIncludes.md"
      
    - name: modifying final files
      run: |
        cp ./output/output.html ./docs/index.html        
        rm -rf ./output
        rm ./all.md
    
    - name: Commit files
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        git commit -m "generate html" -a --allow-empty
          
    - name: Push changes
      uses: ad-m/github-push-action@master
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
